Author: Neha Karanjkar
Last revised on: 12 Feb 2015


The device tree information used by linux kernel
is stored in file AJIT_device_tree.dts.

To generate a device tree blob (assembly)
from a device tree source file,
install device tree compiler (dtc) on the host machine.
We have tested this with dtc version 1.4.


run script:
$./compile_device_tree.sh


--------------------------------------------------------------------------
Explanation:

This script converts a device tree source into an assembly blob and applies a
patch. The patch is needed as the assembly syntax in the generated blob throws
errors in the sparc assembler. The patch replaces 4 byte constants to a word constant.
Example:

	.byte	((_dt_blob_abs_end - _dt_blob_start) >> 24) & 0xff
	.byte	((_dt_blob_abs_end - _dt_blob_start) >> 16) & 0xff
	.byte	((_dt_blob_abs_end - _dt_blob_start) >> 8) & 0xff
	.byte	(_dt_blob_abs_end - _dt_blob_start) & 0xff

is replaced by:
	.word	((_dt_blob_abs_end - _dt_blob_start))
!	.byte	((_dt_blob_abs_end - _dt_blob_start) >> 24) & 0xff
!	.byte	((_dt_blob_abs_end - _dt_blob_start) >> 16) & 0xff
!	.byte	((_dt_blob_abs_end - _dt_blob_start) >> 8) & 0xff
!	.byte	(_dt_blob_abs_end - _dt_blob_start) & 0xff

Note: By default the clock freq is set for C model. 
	Run "fpga_script.sh" and "c_script.sh" for toggling to corresponding 
	clock frequencies.